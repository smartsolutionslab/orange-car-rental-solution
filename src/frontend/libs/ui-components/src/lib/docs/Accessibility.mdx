import { Meta } from '@storybook/blocks';

<Meta title="Getting Started/Accessibility" />

# Accessibility Guidelines

The Orange Car Rental component library is built with accessibility in mind, following WCAG 2.1 AA guidelines.

## Built-in Accessibility Features

### Focus Management

All interactive components have visible focus indicators:

```css
/* Focus ring on interactive elements */
box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.2);
```

Focus is properly managed in:
- **Modal**: Focus trapped within modal, returns to trigger on close
- **Tabs**: Arrow key navigation between tabs
- **Accordion**: Keyboard-accessible expand/collapse
- **Wizard**: Step navigation with focus management

### Semantic HTML

Components use appropriate semantic elements:

```html
<!-- Buttons for actions -->
<button type="button">Click me</button>

<!-- Links for navigation -->
<a href="/page">Go to page</a>

<!-- Fieldsets for form groups -->
<fieldset>
  <legend>Contact Information</legend>
  ...
</fieldset>
```

### ARIA Attributes

Components include proper ARIA attributes:

```html
<!-- Modal -->
<div role="dialog" aria-modal="true" aria-labelledby="modal-title">
  <h2 id="modal-title">Modal Title</h2>
</div>

<!-- Tabs -->
<div role="tablist">
  <button role="tab" aria-selected="true" aria-controls="panel-1">
    Tab 1
  </button>
</div>
<div role="tabpanel" id="panel-1" aria-labelledby="tab-1">
  Content
</div>

<!-- Form inputs with errors -->
<input
  aria-invalid="true"
  aria-describedby="email-error"
/>
<span id="email-error">Please enter a valid email</span>
```

## Keyboard Navigation

### Global Patterns

| Key | Action |
|-----|--------|
| `Tab` | Move focus to next focusable element |
| `Shift + Tab` | Move focus to previous focusable element |
| `Enter` | Activate button, submit form |
| `Space` | Activate button, toggle checkbox/switch |
| `Escape` | Close modal, cancel action |

### Component-Specific

#### Tabs

| Key | Action |
|-----|--------|
| `←` / `→` | Move between tabs (horizontal) |
| `↑` / `↓` | Move between tabs (vertical) |
| `Home` | Move to first tab |
| `End` | Move to last tab |

#### Accordion

| Key | Action |
|-----|--------|
| `Enter` / `Space` | Toggle panel |
| `↑` / `↓` | Move between headers |
| `Home` | Move to first header |
| `End` | Move to last header |

#### Radio Group

| Key | Action |
|-----|--------|
| `←` / `↑` | Select previous option |
| `→` / `↓` | Select next option |
| `Space` | Select focused option |

#### Data Table

| Key | Action |
|-----|--------|
| `Tab` | Move through interactive elements |
| `Enter` | Activate row action, sort column |
| `Space` | Toggle row selection |

## Color Contrast

All text meets WCAG AA contrast requirements:

| Element | Foreground | Background | Ratio |
|---------|------------|------------|-------|
| Body text | `#374151` | `#ffffff` | 7.5:1 |
| Muted text | `#6b7280` | `#ffffff` | 4.6:1 |
| Link text | `#f97316` | `#ffffff` | 4.5:1 |
| Error text | `#ef4444` | `#ffffff` | 4.5:1 |
| Button text | `#ffffff` | `#f97316` | 4.5:1 |

### Status Colors

Status badges maintain readable contrast:

| Status | Text Color | Background | Ratio |
|--------|------------|------------|-------|
| Confirmed | `#166534` | `#dcfce7` | 7.1:1 |
| Pending | `#854d0e` | `#fef3c7` | 7.0:1 |
| Cancelled | `#991b1b` | `#fee2e2` | 6.9:1 |

## Form Accessibility

### Labels

All form inputs must have associated labels:

```html
<!-- Using component's label prop -->
<ocr-input label="Email Address" />

<!-- Or with explicit association -->
<label for="custom-input">Email Address</label>
<input id="custom-input" />
```

### Error Messages

Error messages are linked to inputs via `aria-describedby`:

```html
<ocr-input
  label="Email"
  [error]="'Please enter a valid email address'"
/>

<!-- Renders as: -->
<input
  aria-invalid="true"
  aria-describedby="input-123-error"
/>
<span id="input-123-error">Please enter a valid email address</span>
```

### Required Fields

Required fields are marked visually and programmatically:

```html
<ocr-input
  label="Email"
  [required]="true"
/>

<!-- Renders with asterisk and aria-required -->
<label>Email <span aria-hidden="true">*</span></label>
<input aria-required="true" />
```

### Form Validation

- Errors are announced to screen readers
- Focus moves to first error on form submission
- Error states are indicated with color AND text

## Screen Reader Support

### Live Regions

Dynamic content updates are announced:

```html
<!-- Loading state -->
<div aria-live="polite" aria-busy="true">
  Loading...
</div>

<!-- Success message -->
<div role="status" aria-live="polite">
  Your reservation has been confirmed.
</div>

<!-- Error alert -->
<div role="alert">
  An error occurred. Please try again.
</div>
```

### Hidden Content

Decorative elements are hidden from screen readers:

```html
<!-- Decorative icon -->
<lib-icon name="check" aria-hidden="true" />

<!-- Decorative image -->
<img src="decoration.svg" alt="" role="presentation" />
```

### Alternative Text

Images convey meaning through alt text:

```html
<!-- Informative image -->
<img src="car.jpg" alt="2024 BMW 3 Series sedan in blue" />

<!-- Image in link -->
<a href="/vehicles/123">
  <img src="car.jpg" alt="" />
  <span>View 2024 BMW 3 Series</span>
</a>
```

## Motion & Animation

### Reduced Motion

Components respect `prefers-reduced-motion`:

```css
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}
```

### Safe Animations

- No flashing content (prevents seizures)
- Animations under 5 seconds
- Users can pause/stop animations

## Testing Accessibility

### Automated Testing

Run accessibility audits with axe-core:

```bash
# In Storybook
npm run storybook
# Use the Accessibility addon tab
```

### Manual Testing

1. **Keyboard Testing**: Navigate with keyboard only
2. **Screen Reader**: Test with NVDA, VoiceOver, or JAWS
3. **Zoom**: Test at 200% zoom
4. **Color**: Use grayscale filter to check contrast

### Checklist

For each new component, verify:

- [ ] All interactive elements are focusable
- [ ] Focus order is logical
- [ ] Focus is visible
- [ ] Color is not the only indicator
- [ ] Text alternatives exist for images
- [ ] Form inputs have labels
- [ ] Error messages are accessible
- [ ] Keyboard navigation works
- [ ] Screen reader announces content correctly
- [ ] Content is readable at 200% zoom

## Resources

- [WCAG 2.1 Guidelines](https://www.w3.org/WAI/WCAG21/quickref/)
- [WAI-ARIA Authoring Practices](https://www.w3.org/WAI/ARIA/apg/)
- [Angular A11y Guide](https://angular.io/guide/accessibility)
- [Inclusive Components](https://inclusive-components.design/)
