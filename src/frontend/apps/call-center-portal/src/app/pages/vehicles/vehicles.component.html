<div class="page-header">
  <h1>{{ 'vehicles.title' | translate }}</h1>
  <p class="subtitle">{{ 'vehicles.subtitle' | translate }}</p>
</div>

<div class="dashboard-grid">
  <ui-stat-card
    [label]="'vehicles.stats.total' | translate"
    [value]="totalVehicles()"
    [loading]="loading()"
    iconName="car-filled"
  />
  <ui-stat-card
    [label]="'vehicles.stats.available' | translate"
    [value]="availableVehicles()"
    [loading]="loading()"
    variant="success"
  />
  <ui-stat-card
    [label]="'vehicles.stats.maintenance' | translate"
    [value]="maintenanceVehicles()"
    [loading]="loading()"
    variant="warning"
  />
  <ui-stat-card
    [label]="'vehicles.stats.rented' | translate"
    [value]="rentedVehicles()"
    [loading]="loading()"
    variant="info"
  />
</div>

<div class="content-section">
  <div class="section-header">
    <h2>{{ 'vehicles.overview' | translate }}</h2>
    <button class="btn-primary" disabled>
      <lib-icon name="plus-filled" variant="filled" size="md" aria-hidden="true" />
      {{ 'vehicles.addNew' | translate }}
    </button>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <div class="filter-group">
      <label for="statusFilter">{{ 'common.labels.status' | translate }}</label>
      <ui-select-vehicle-status
        id="statusFilter"
        [ngModel]="searchStatus()"
        (ngModelChange)="searchStatus.set($event); applyFilters()"
        [placeholder]="'vehicles.filters.allStatuses' | translate"
      />
    </div>

    <div class="filter-group">
      <label for="locationFilter">{{ 'common.labels.location' | translate }}</label>
      <ui-select-location
        id="locationFilter"
        [ngModel]="searchLocation()"
        (ngModelChange)="searchLocation.set($event); applyFilters()"
        [placeholder]="'vehicles.filters.allLocations' | translate"
      />
    </div>

    <div class="filter-group">
      <label for="categoryFilter">{{ 'common.labels.category' | translate }}</label>
      <ui-select-category
        id="categoryFilter"
        [ngModel]="searchCategory()"
        (ngModelChange)="searchCategory.set($event); applyFilters()"
        [placeholder]="'vehicles.filters.allCategories' | translate"
      />
    </div>

    <button class="btn-secondary" (click)="clearFilters()">
      {{ 'common.actions.resetFilters' | translate }}
    </button>
  </div>

  <!-- Loading State -->
  @if (loading()) {
    <ui-loading-state [message]="'vehicles.loading' | translate"></ui-loading-state>
  }

  <!-- Error State -->
  @if (error()) {
    <ui-error-state
      [message]="error()!"
      [showRetry]="true"
      (retry)="loadVehicles()"
    ></ui-error-state>
  }

  <!-- Vehicles Table -->
  @if (!loading() && !error() && vehicles().length > 0) {
    <div class="table-container">
      <table class="data-table">
        <thead>
          <tr>
            <th>{{ 'vehicles.table.licensePlate' | translate }}</th>
            <th>{{ 'vehicles.table.vehicle' | translate }}</th>
            <th>{{ 'vehicles.table.category' | translate }}</th>
            <th>{{ 'vehicles.table.location' | translate }}</th>
            <th>{{ 'vehicles.table.dailyRate' | translate }}</th>
            <th>{{ 'vehicles.table.status' | translate }}</th>
            <th>{{ 'common.labels.actions' | translate }}</th>
          </tr>
        </thead>
        <tbody>
          @for (vehicle of vehicles(); track vehicle.id) {
            <tr>
              <td>
                @if (vehicle.licensePlate) {
                  <span class="license-plate">{{ vehicle.licensePlate }}</span>
                } @else {
                  <span class="text-muted">-</span>
                }
              </td>
              <td>{{ vehicle.manufacturer }} {{ vehicle.model }} ({{ vehicle.year }})</td>
              <td>{{ vehicle.categoryCode }}</td>
              <td>{{ vehicle.locationCode }}</td>
              <td>{{ vehicle.dailyRateGross.toFixed(2) }} {{ vehicle.currency }}</td>
              <td><ui-status-badge type="vehicle" [status]="vehicle.status"></ui-status-badge></td>
              <td>
                <button
                  class="btn-icon"
                  (click)="viewDetails(vehicle)"
                  [title]="'common.actions.viewDetails' | translate"
                  [attr.aria-label]="'vehicles.ariaLabels.viewDetails' | translate"
                >
                  <lib-icon name="eye-filled" variant="filled" size="sm" aria-hidden="true" />
                </button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }

  <!-- No Results -->
  @if (!loading() && !error() && vehicles().length === 0) {
    <ui-empty-state
      icon="car"
      [title]="'vehicles.noResults.title' | translate"
      [description]="'vehicles.noResults.description' | translate"
      [showAction]="true"
      [actionLabel]="'common.actions.resetFilters' | translate"
      (action)="clearFilters()"
    ></ui-empty-state>
  }
</div>

<!-- Vehicle Details Modal -->
<ui-modal
  [isOpen]="showDetails() && !!selectedVehicle()"
  [title]="'vehicles.details.title' | translate"
  size="lg"
  (close)="closeDetails()"
>
  <ng-container modal-body>
    @if (selectedVehicle()) {
      <!-- Vehicle Information -->
      <div class="info-section">
        <h3>{{ 'vehicles.details.info' | translate }}</h3>
        <div class="detail-grid">
          <div class="detail-item">
            <label>{{ 'vehicles.details.vehicleId' | translate }}</label>
            <p>
              <span class="id-badge">{{ selectedVehicle()!.id }}</span>
            </p>
          </div>
          <div class="detail-item">
            <label>{{ 'vehicles.table.licensePlate' | translate }}</label>
            <p>
              @if (selectedVehicle()!.licensePlate) {
                <span class="license-plate">{{ selectedVehicle()!.licensePlate }}</span>
              } @else {
                <span class="text-muted">{{ 'vehicles.details.notAssigned' | translate }}</span>
              }
            </p>
          </div>
          <div class="detail-item">
            <label>{{ 'vehicles.details.manufacturerModel' | translate }}</label>
            <p>{{ selectedVehicle()!.manufacturer }} {{ selectedVehicle()!.model }}</p>
          </div>
          <div class="detail-item">
            <label>{{ 'vehicles.details.year' | translate }}</label>
            <p>{{ selectedVehicle()!.year }}</p>
          </div>
          <div class="detail-item">
            <label>{{ 'vehicles.table.category' | translate }}</label>
            <p>{{ selectedVehicle()!.categoryCode }} - {{ selectedVehicle()!.categoryName }}</p>
          </div>
          <div class="detail-item">
            <label>{{ 'vehicles.table.status' | translate }}</label>
            <p>
              <ui-status-badge
                type="vehicle"
                [status]="selectedVehicle()!.status"
              ></ui-status-badge>
            </p>
          </div>
        </div>
      </div>

      <!-- Location & Pricing -->
      <div class="info-section">
        <h3>{{ 'vehicles.details.locationPricing' | translate }}</h3>
        <div class="detail-grid">
          <div class="detail-item">
            <label>{{ 'vehicles.table.location' | translate }}</label>
            <p>{{ selectedVehicle()!.locationCode }} - {{ selectedVehicle()!.city }}</p>
          </div>
          <div class="detail-item">
            <label>{{ 'vehicles.details.dailyRateNet' | translate }}</label>
            <p>
              {{ selectedVehicle()!.dailyRateNet.toFixed(2) }} {{ selectedVehicle()!.currency }}
            </p>
          </div>
          <div class="detail-item">
            <label>{{ 'vehicles.details.vat' | translate }}</label>
            <p>
              {{ selectedVehicle()!.dailyRateVat.toFixed(2) }} {{ selectedVehicle()!.currency }}
            </p>
          </div>
          <div class="detail-item">
            <label>{{ 'vehicles.details.dailyRateGross' | translate }}</label>
            <p>
              <strong
                >{{ selectedVehicle()!.dailyRateGross.toFixed(2) }}
                {{ selectedVehicle()!.currency }}</strong
              >
            </p>
          </div>
        </div>
      </div>

      <!-- Features -->
      <div class="info-section">
        <h3>{{ 'vehicles.details.features' | translate }}</h3>
        <div class="detail-grid">
          <div class="detail-item">
            <label>{{ 'vehicles.details.transmission' | translate }}</label>
            <p>
              {{
                selectedVehicle()!.transmissionType === 'Automatic'
                  ? ('vehicles.transmission.automatic' | translate)
                  : ('vehicles.transmission.manual' | translate)
              }}
            </p>
          </div>
          <div class="detail-item">
            <label>{{ 'vehicles.details.fuelType' | translate }}</label>
            <p>{{ selectedVehicle()!.fuelType }}</p>
          </div>
          <div class="detail-item">
            <label>{{ 'vehicles.details.seats' | translate }}</label>
            <p>{{ selectedVehicle()!.seats }}</p>
          </div>
        </div>
      </div>
    }
  </ng-container>
  <ng-container modal-footer>
    <button class="btn-secondary" (click)="closeDetails()">
      {{ 'common.actions.close' | translate }}
    </button>
  </ng-container>
</ui-modal>
