<div class="forgot-password-container">
  <div class="forgot-password-card">
    <!-- Header -->
    <div class="header">
      @if (!emailSent()) {
        <div class="icon-wrapper">
          <lib-icon name="lock" variant="outline" size="lg" class="lock-icon" />
        </div>
        <h1 class="title">Passwort vergessen?</h1>
        <p class="subtitle">
          Kein Problem! Geben Sie Ihre E-Mail-Adresse ein und wir senden Ihnen einen Link zum
          Zurücksetzen.
        </p>
      } @else {
        <div class="icon-wrapper success">
          <lib-icon name="mail-open" variant="outline" size="lg" class="check-icon" />
        </div>
        <h1 class="title">E-Mail gesendet!</h1>
        <p class="subtitle">Überprüfen Sie Ihren Posteingang</p>
      }
    </div>

    <!-- Success Message -->
    @if (successMessage()) {
      <ui-success-alert [message]="successMessage()!"></ui-success-alert>
    }

    <!-- Error Message -->
    @if (errorMessage()) {
      <ui-error-alert [message]="errorMessage()!"></ui-error-alert>
    }

    <!-- Form -->
    @if (!emailSent()) {
      <form [formGroup]="forgotPasswordForm" (ngSubmit)="onSubmit()" class="form">
        <ui-form-field
          label="E-Mail-Adresse"
          inputId="email"
          [required]="true"
          [hasError]="!!emailError"
          [errorMessage]="emailError"
        >
          <input
            id="email"
            type="email"
            formControlName="email"
            placeholder="ihre-email@beispiel.de"
            autocomplete="email"
          />
        </ui-form-field>

        <button type="submit" class="submit-button" [disabled]="isLoading()">
          @if (isLoading()) {
            <svg class="spinner" viewBox="0 0 24 24">
              <circle
                class="spinner-circle"
                cx="12"
                cy="12"
                r="10"
                stroke="currentColor"
                stroke-width="4"
                fill="none"
              ></circle>
            </svg>
            <span>Wird gesendet...</span>
          } @else {
            <span>Link zum Zurücksetzen senden</span>
          }
        </button>
      </form>
    }

    <!-- Additional Info -->
    @if (emailSent()) {
      <div class="info-box">
        <p class="info-title">Was kommt als Nächstes?</p>
        <ol class="info-list">
          <li>Überprüfen Sie Ihren Posteingang (und Spam-Ordner)</li>
          <li>Klicken Sie auf den Link in der E-Mail</li>
          <li>Erstellen Sie ein neues Passwort</li>
          <li>Melden Sie sich mit Ihrem neuen Passwort an</li>
        </ol>
        <p class="info-note">Der Link ist 24 Stunden lang gültig.</p>
      </div>

      <button
        type="button"
        class="resend-button"
        [disabled]="isLoading()"
        (click)="emailSent.set(false)"
      >
        Eine weitere E-Mail senden
      </button>
    }

    <!-- Back to Login -->
    <div class="back-to-login">
      <a routerLink="/login" class="back-link">
        <lib-icon name="arrow-left" variant="outline" size="sm" class="arrow-icon" />
        <span>Zurück zur Anmeldung</span>
      </a>
    </div>
  </div>
</div>
