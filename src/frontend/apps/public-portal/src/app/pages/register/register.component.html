<div class="register-container">
  <div class="register-card">
    <!-- Header -->
    <div class="register-header">
      <h1 class="register-title">{{ 'auth.register.title' | translate }}</h1>
      <p class="register-subtitle">{{ 'auth.register.subtitle' | translate }}</p>
    </div>

    <!-- Progress Steps -->
    <div class="progress-steps">
      @for (step of [1, 2, 3]; track step) {
        <div
          class="progress-step"
          [class.active]="step <= currentStep()"
          [class.current]="step === currentStep()"
        >
          <div class="step-number">{{ step }}</div>
          <div class="step-label">
            @if (step === 1) {
              <span>{{ 'auth.register.steps.account' | translate }}</span>
            }
            @if (step === 2) {
              <span>{{ 'auth.register.steps.personal' | translate }}</span>
            }
            @if (step === 3) {
              <span>{{ 'auth.register.steps.confirmation' | translate }}</span>
            }
          </div>
        </div>
      }
    </div>

    <!-- Error/Success Messages -->
    @if (errorMessage()) {
      <ui-error-alert [message]="errorMessage()!"></ui-error-alert>
    }

    @if (successMessage()) {
      <ui-success-alert [message]="successMessage()!"></ui-success-alert>
    }

    <!-- Registration Form -->
    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="register-form">
      <!-- Step 1: Account Information -->
      @if (currentStep() === 1) {
        <div class="form-step">
          <ocr-input
            [label]="'common.labels.email' | translate"
            type="email"
            formControlName="email"
            [placeholder]="'common.placeholders.email' | translate"
            autocomplete="email"
            leadingIcon="mail"
            [required]="true"
            [error]="emailError"
          />

          <div class="password-field-with-hint">
            <ocr-input
              [label]="'common.labels.password' | translate"
              type="password"
              formControlName="password"
              placeholder="••••••••"
              autocomplete="new-password"
              leadingIcon="lock"
              [showPasswordToggle]="true"
              [required]="true"
              [error]="passwordError"
            />
            <span class="field-hint">{{ 'auth.register.passwordHint' | translate }}</span>
          </div>

          <ocr-input
            [label]="'auth.register.confirmPassword' | translate"
            type="password"
            formControlName="confirmPassword"
            placeholder="••••••••"
            autocomplete="new-password"
            leadingIcon="lock"
            [showPasswordToggle]="true"
            [required]="true"
            [error]="confirmPasswordError"
          />
        </div>
      }

      <!-- Step 2: Personal Information -->
      @if (currentStep() === 2) {
        <div class="form-step">
          <div class="form-row">
            <ocr-input
              [label]="'common.labels.firstName' | translate"
              type="text"
              formControlName="firstName"
              [placeholder]="'common.placeholders.firstName' | translate"
              autocomplete="given-name"
              leadingIcon="user"
              [required]="true"
              [error]="firstNameError"
            />

            <ocr-input
              [label]="'common.labels.lastName' | translate"
              type="text"
              formControlName="lastName"
              [placeholder]="'common.placeholders.lastName' | translate"
              autocomplete="family-name"
              leadingIcon="user"
              [required]="true"
              [error]="lastNameError"
            />
          </div>

          <ocr-input
            [label]="'common.labels.phone' | translate"
            type="tel"
            formControlName="phoneNumber"
            placeholder="+49 123 456789"
            autocomplete="tel"
            leadingIcon="phone"
            [required]="true"
            [error]="phoneNumberError"
          />

          <div class="date-field-with-hint">
            <div class="form-group">
              <label for="dateOfBirth" class="form-label"
                >{{ 'common.labels.dateOfBirth' | translate }} *</label
              >
              <input
                id="dateOfBirth"
                type="date"
                formControlName="dateOfBirth"
                class="form-input"
                [class.input-error]="dateOfBirthError"
                autocomplete="bday"
              />
              @if (dateOfBirthError) {
                <span class="field-error">{{ dateOfBirthError }}</span>
              }
            </div>
            <span class="field-hint">{{ 'auth.register.ageHint' | translate }}</span>
          </div>
        </div>
      }

      <!-- Step 3: Terms and Conditions -->
      @if (currentStep() === 3) {
        <div class="form-step">
          <ocr-checkbox formControlName="acceptTerms" [required]="true">
            {{ 'auth.register.acceptTermsPrefix' | translate }}
            <a href="/terms" target="_blank" class="terms-link">{{
              'auth.register.termsLink' | translate
            }}</a>
          </ocr-checkbox>

          <ocr-checkbox formControlName="acceptPrivacy" [required]="true">
            {{ 'auth.register.acceptPrivacyPrefix' | translate }}
            <a href="/privacy" target="_blank" class="terms-link">{{
              'auth.register.privacyLink' | translate
            }}</a>
          </ocr-checkbox>

          <ocr-checkbox formControlName="acceptMarketing">
            {{ 'auth.register.acceptMarketing' | translate }}
          </ocr-checkbox>

          <div class="info-box">
            <lib-icon name="information-circle" variant="outline" size="sm" class="info-icon" />
            <div>
              <p class="info-title">{{ 'auth.register.privacyInfoTitle' | translate }}</p>
              <p class="info-text">{{ 'auth.register.privacyInfoText' | translate }}</p>
            </div>
          </div>
        </div>
      }

      <!-- Navigation Buttons -->
      <div class="form-actions">
        @if (currentStep() > 1) {
          <button type="button" class="secondary-button" (click)="previousStep()">
            {{ 'common.actions.back' | translate }}
          </button>
        }

        @if (currentStep() < totalSteps) {
          <button
            type="button"
            class="primary-button"
            (click)="nextStep()"
            [class.full-width]="currentStep() === 1"
          >
            {{ 'common.actions.next' | translate }}
          </button>
        }

        @if (currentStep() === totalSteps) {
          <button type="submit" class="primary-button" [disabled]="isLoading()">
            @if (isLoading()) {
              <svg class="spinner" viewBox="0 0 24 24">
                <circle
                  class="spinner-circle"
                  cx="12"
                  cy="12"
                  r="10"
                  stroke="currentColor"
                  stroke-width="4"
                  fill="none"
                ></circle>
              </svg>
              <span>{{ 'auth.register.submitting' | translate }}</span>
            } @else {
              <span>{{ 'auth.register.submit' | translate }}</span>
            }
          </button>
        }
      </div>
    </form>

    <!-- Login Link -->
    <div class="login-section">
      <p class="login-text">
        {{ 'auth.register.hasAccount' | translate }}
        <a routerLink="/login" class="login-link">{{ 'auth.register.loginNow' | translate }}</a>
      </p>
    </div>
  </div>
</div>
